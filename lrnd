local RN_BROADCAST = 65535
local lyqydnet = false

process.addHook({"modem_message"})

while true do
	local event = {os.pullEventRaw()}
	if not lyqydnet then lyqydnet = process.getFromName("lyqydnet") end
	if event[1] == "modem_message" then
		if lyqydnet then
			lyqydnet:queue(unpack(event))
		else
			local rm = event[3] == os.getComputerID() or event[3] == RN_BROADCAST
			for pID, proc in pairs(process.list) do
				if proc and proc.name ~= "lrnd" and proc.name ~= "lyqydnet" and proc.modem and proc.modem[event[2]] and proc.modem[event[2]][event[3]] then
					proc:queue(unpack(event))
				end
				if rm and proc and proc.rednet and proc.rednet[event[2]] then
					if term.current then
						proc:queue("rednet_message", event[4], event[5].message, event[5].sProtocol)
					else
						proc:queue("rednet_message", event[4], event[5], event[6])
					end
				end
			end
		end
	end
end
